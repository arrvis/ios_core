#!/bin/sh

cd `dirname $0` && cd ../

git clean -fdx

cache_prefix=`xcrun swift --version | head -1 | sed 's/.*\((.*)\).*/\1/' | tr -d "()" | tr " " "-"`

rome download --platform iOS --cache-prefix $cache_prefix
carthage bootstrap --platform iOS --no-use-binaries --cache-builds
rome list --missing --platform iOS --cache-prefix $cache_prefix | awk '{print $1}' | xargs rome upload --platform iOS --cache-prefix $cache_prefix
